<html>
  <head>
    <title>Tiny Towns</title>

    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        fetch('/firebaseConfig.json')
          .then(res => res.json())
          .then(config => {
            firebase.initializeApp(config);
            const auth = firebase.auth();

            const login_card = document.getElementById('login_card');
            const game = document.getElementById('game');
            const logout_button = document.getElementById('logout_button');

            document.getElementById('login_button')
              .addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                auth.signInWithEmailAndPassword(email, password)
                  .catch(e => alert(e.message));
              });

            document.getElementById('register_button')
              .addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                auth.createUserWithEmailAndPassword(email, password)
                  .catch(e => alert(e.message));
              });

            document.getElementById('google_button')
              .addEventListener('click', () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.setCustomParameters({ prompt: 'select_account' });
                auth.signInWithPopup(provider)
                  .catch(e => alert(e.message));
              });

            logout_button.addEventListener('click', () => {
              auth.signOut().catch(e => alert(e.message));
            });

            auth.onAuthStateChanged(user => {
              if (user) {
                document.title = user.displayName || user.email;

                login_card.classList.add('hidden');
                game.classList.remove('hidden');
                logout_button.classList.remove('hidden');
              } else {
                document.title = 'Tiny Towns';

                login_card.classList.remove('hidden');
                game.classList.add('hidden');
                logout_button.classList.add('hidden');
              }
            });
          })
          .catch(err => console.error('Failed to load Firebase config:', err));
      });
    </script>
  </head>

  <body>
    <div id="login_card">
      <input id="email" placeholder="email"/>
      <input id="password" placeholder="password"/>
      <button id="login_button">(login)</button>
      <button id="register_button">(register)</button>
      <button id="google_button">(login with google)</button>
    </div>

    <button id="logout_button" class="hidden" style="background-color: rgb(137, 68, 24); width: 100%;">Logout</button>

    <div id="game" class="hidden">
      <script type="module" src="/src/main.jsx"></script>
    </div>
    <script type="module" src="/src/main.js" defer></script>
  </body>
</html>
